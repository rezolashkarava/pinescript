//@version=6
indicator("Pagani Dashboard Hub [Unified]", overlay=true)

// ============================================================================
// PAGANI DASHBOARD HUB V1.0 - UNIFIED DASHBOARD
// Consolidates key information from:
// â€¢ BTC Volume Analysis [Paganie] - Buy/Sell pressure, MTF sentiment
// â€¢ Breakout Quality Engine [BQE] - Sessions, Zones, HTF Bias, Key Levels
// â€¢ ICT Order Block Pro [Paganie] - Context awareness
//
// Usage: Enable this dashboard, disable dashboards on individual indicators
// ============================================================================

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// INPUTS
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// === SYMBOL ===
string G_SYM = "â‚¿ Symbol"
useCurrentChart = input.bool(true, "Use Current Chart Symbol", group=G_SYM)
customSymbol = input.string("BINANCE:BTCUSDT.P", "Custom Symbol", group=G_SYM,
     tooltip="Only used when 'Use Current Chart' is OFF")
string effectiveSymbol = useCurrentChart ? syminfo.tickerid : customSymbol

// === SECTIONS ===
string G_SECTIONS = "ğŸ“Š Dashboard Sections"
showPriceRow = input.bool(true, "Show Price", group=G_SECTIONS)
showContextRow = input.bool(true, "Show Context (Session/Zone/Bias)", group=G_SECTIONS)
showVolumeRow = input.bool(true, "Show Volume Analysis", group=G_SECTIONS)
showMtfRow = input.bool(true, "Show MTF Sentiment", group=G_SECTIONS)
showLevelsRow = input.bool(true, "Show Key Levels", group=G_SECTIONS)

// === SESSIONS ===
string G_SESSION = "ğŸ• Sessions"
londonStart = input.int(2, "London Start (UTC)", minval=0, maxval=23, group=G_SESSION)
londonEnd = input.int(5, "London End (UTC)", minval=0, maxval=23, group=G_SESSION)
nyStart = input.int(8, "NY Start (UTC)", minval=0, maxval=23, group=G_SESSION)
nyEnd = input.int(11, "NY End (UTC)", minval=0, maxval=23, group=G_SESSION)
asiaStart = input.int(23, "Asia Start (UTC)", minval=0, maxval=23, group=G_SESSION)
asiaEnd = input.int(2, "Asia End (UTC)", minval=0, maxval=23, group=G_SESSION)

// === ZONES ===
string G_ZONES = "ğŸ“ Premium/Discount"
zoneLookback = input.int(50, "Zone Lookback", minval=20, maxval=100, group=G_ZONES)

// === HTF BIAS ===
string G_BIAS = "ğŸ“ˆ HTF Bias"
htfTimeframe = input.timeframe("240", "HTF Timeframe", group=G_BIAS)
htfEmaLen = input.int(21, "HTF EMA Length", minval=5, maxval=50, group=G_BIAS)

// === VOLUME ANALYSIS ===
string G_VOL = "ğŸ“Š Volume Analysis"
volumeMethod = input.string("Pressure", "Volume Method", options=["Pressure", "Polarity"], group=G_VOL)
avgVolumePeriod = input.int(10, "Average Period", minval=1, maxval=50, group=G_VOL)
smoothingLen = input.int(3, "Smoothing Length", minval=1, maxval=10, group=G_VOL)

// === MTF SETTINGS ===
string G_MTF = "â±ï¸ MTF Timeframes"
tf1 = input.timeframe("1", "TF 1", group=G_MTF)
tf2 = input.timeframe("5", "TF 2", group=G_MTF)
tf3 = input.timeframe("15", "TF 3", group=G_MTF)
tf4 = input.timeframe("60", "TF 4", group=G_MTF)

// === KEY LEVELS ===
string G_LEVELS = "ğŸ“Š Key Levels"
usePdhPdl = input.bool(true, "PDH/PDL", group=G_LEVELS)
usePwhPwl = input.bool(true, "PWH/PWL", group=G_LEVELS)

// === APPEARANCE ===
string G_VIS = "ğŸ¨ Appearance"
dashPosition = input.string("Top Right", "Position",
     options=["Top Right", "Top Left", "Bottom Right", "Bottom Left", "Middle Right", "Middle Left"], group=G_VIS)
dashSize = input.string("small", "Text Size", options=["tiny", "small", "normal"], group=G_VIS)
dashTransparency = input.int(15, "Background Transparency", minval=0, maxval=90, step=5, group=G_VIS)

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// COLORS
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
color C_BULL = #00ff88
color C_BEAR = #ff3366
color C_NEUTRAL = #888888
color C_WARN = #ffaa00
color C_OTE = #ffd700

// Detect light/dark mode
color chartBg = chart.bg_color
float bgLuminance = 0.299 * (color.r(chartBg) / 255.0) + 0.587 * (color.g(chartBg) / 255.0) + 0.114 * (color.b(chartBg) / 255.0)
bool isLightMode = bgLuminance > 0.5
color textColor = isLightMode ? color.black : color.white
color dimColor = isLightMode ? color.new(color.black, 40) : color.gray
color bgColor = color.new(#000000, dashTransparency)

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// HELPER FUNCTIONS
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
round2(float x) => na(x) ? na : math.round(x * 100) / 100

formatVolume(float vol) =>
    string s = ""
    if na(vol) or vol == 0
        s := "0"
    else
        float m = vol / 1000000.0
        float k = vol / 1000.0
        if m >= 1.0
            s := str.tostring(math.round(m * 10) / 10) + "M"
        else if k >= 1.0
            s := str.tostring(math.round(k * 10) / 10) + "k"
        else
            s := str.tostring(math.round(vol))
    s

formatPrice(float price) =>
    na(price) ? "â€”" : price >= 1000 ? str.tostring(price, "#.##") : price >= 1 ? str.tostring(price, "#.####") : str.tostring(price, "#.######")

formatTf(string tf) =>
    int tfMins = timeframe.in_seconds(tf) / 60
    tfMins < 60 ? str.tostring(tfMins) : tfMins < 1440 ? str.tostring(tfMins / 60) + "H" : tfMins == 1440 ? "D" : tf

getShortSymbol(string sym) =>
    int colonPos = str.pos(sym, ":")
    colonPos >= 0 ? str.substring(sym, colonPos + 1) : sym

inSession(int startHour, int endHour, int currentHour) =>
    startHour <= endHour ? (currentHour >= startHour and currentHour < endHour) : (currentHour >= startHour or currentHour < endHour)

getDashPos(string loc) =>
    switch loc
        "Top Left" => position.top_left
        "Top Right" => position.top_right
        "Bottom Left" => position.bottom_left
        "Bottom Right" => position.bottom_right
        "Middle Left" => position.middle_left
        "Middle Right" => position.middle_right
        => position.top_right

getTextSize(string sz) =>
    switch sz
        "tiny" => size.tiny
        "small" => size.small
        "normal" => size.normal
        => size.small

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// SESSION DETECTION
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
int hourUtc = hour(time, "UTC")
int minuteUtc = minute(time, "UTC")

bool inLondonKZ = inSession(londonStart, londonEnd, hourUtc)
bool inNyKZ = inSession(nyStart, nyEnd, hourUtc)
bool inAsiaKZ = inSession(asiaStart, asiaEnd, hourUtc)
bool inOverlapKZ = inLondonKZ and inNyKZ
bool inAnyKillzone = inLondonKZ or inNyKZ or inAsiaKZ

bool isMacroTime = minuteUtc == 0 or minuteUtc == 30 or minuteUtc == 50

string sessionName = inOverlapKZ ? "LDN/NY" : inNyKZ ? "NY" : inLondonKZ ? "LDN" : inAsiaKZ ? "ASIA" : "OFF"
color sessionColor = inOverlapKZ ? C_BULL : inAnyKillzone ? color.new(C_BULL, 30) : dimColor

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// PREMIUM/DISCOUNT ZONES
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
float swingHigh = ta.highest(high, zoneLookback)
float swingLow = ta.lowest(low, zoneLookback)
float swingRange = swingHigh - swingLow
float equilibrium = swingLow + swingRange * 0.5

bool inDiscount = close < equilibrium
bool inPremium = close > equilibrium

// OTE zones (62-79% retracement)
float oteLongTop = swingLow + swingRange * 0.38
float oteLongBot = swingLow + swingRange * 0.21
float oteShortBot = swingLow + swingRange * 0.62
float oteShortTop = swingLow + swingRange * 0.79

bool inOteLong = close >= oteLongBot and close <= oteLongTop
bool inOteShort = close >= oteShortBot and close <= oteShortTop

string zoneName = inDiscount ? "DISC" : inPremium ? "PREM" : "EQ"
color zoneColor = inDiscount ? C_BULL : inPremium ? C_BEAR : dimColor
string oteText = inOteLong ? "OTEâ–²" : inOteShort ? "OTEâ–¼" : ""

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// HTF BIAS
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[htfClose, htfEma] = request.security(syminfo.tickerid, htfTimeframe, [close, ta.ema(close, htfEmaLen)], lookahead=barmerge.lookahead_off)

bool htfBullish = not na(htfEma) and htfClose > htfEma
bool htfBearish = not na(htfEma) and htfClose < htfEma

string biasName = htfBullish ? "BULL" : htfBearish ? "BEAR" : "â€”"
color biasColor = htfBullish ? C_BULL : htfBearish ? C_BEAR : dimColor

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// LIVE PRICE
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[livePrice, livePriceOpen] = request.security(effectiveSymbol, timeframe.period, [close, open], lookahead=barmerge.lookahead_off)
bool priceUp = livePrice >= livePriceOpen
color priceColor = priceUp ? C_BULL : C_BEAR
string priceArrow = priceUp ? " â–²" : " â–¼"

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// KEY LEVELS (PDH/PDL, PWH/PWL)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
int yUtc = year(time, "UTC")
int mUtc = month(time, "UTC")
int dUtc = dayofmonth(time, "UTC")
int wUtc = weekofyear(time, "UTC")

int dayId = yUtc * 10000 + mUtc * 100 + dUtc
int weekId = yUtc * 100 + wUtc

var int lastDayId = na
var int lastWeekId = na
var float dayHigh = na, var float dayLow = na
var float pdh = na, var float pdl = na
var float weekHigh = na, var float weekLow = na
var float pwh = na, var float pwl = na

bool newDay = not na(lastDayId) and dayId != lastDayId
bool newWeek = not na(lastWeekId) and weekId != lastWeekId

// Update daily
if na(lastDayId)
    lastDayId := dayId
    dayHigh := high
    dayLow := low
else if newDay
    pdh := dayHigh
    pdl := dayLow
    dayHigh := high
    dayLow := low
    lastDayId := dayId
else
    dayHigh := math.max(dayHigh, high)
    dayLow := math.min(dayLow, low)

// Update weekly
if na(lastWeekId)
    lastWeekId := weekId
    weekHigh := high
    weekLow := low
else if newWeek
    pwh := weekHigh
    pwl := weekLow
    weekHigh := high
    weekLow := low
    lastWeekId := weekId
else
    weekHigh := math.max(weekHigh, high)
    weekLow := math.min(weekLow, low)

// Find nearest levels
var float nearestAbove = na
var string nearestAboveName = ""
var float nearestBelow = na
var string nearestBelowName = ""

nearestAbove := na
nearestAboveName := ""
nearestBelow := na
nearestBelowName := ""

// Check levels above
if usePwhPwl and not na(pwh) and pwh > close
    if na(nearestAbove) or pwh < nearestAbove
        nearestAbove := pwh
        nearestAboveName := "PWH"

if usePdhPdl and not na(pdh) and pdh > close
    if na(nearestAbove) or pdh < nearestAbove
        nearestAbove := pdh
        nearestAboveName := "PDH"

// Check levels below
if usePwhPwl and not na(pwl) and pwl < close
    if na(nearestBelow) or pwl > nearestBelow
        nearestBelow := pwl
        nearestBelowName := "PWL"

if usePdhPdl and not na(pdl) and pdl < close
    if na(nearestBelow) or pdl > nearestBelow
        nearestBelow := pdl
        nearestBelowName := "PDL"

float distAbove = not na(nearestAbove) ? round2((nearestAbove - close) / close * 100) : na
float distBelow = not na(nearestBelow) ? round2((close - nearestBelow) / close * 100) : na

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// INTRABAR VOLUME ANALYSIS
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
float tf_in_minutes = timeframe.in_seconds() / 60.0

getPowerLtf() =>
    tf_in_minutes <= 5 ? "1" : tf_in_minutes <= 15 ? "1" : tf_in_minutes <= 60 ? "5" : tf_in_minutes <= 240 ? "15" : "60"

string powerLtf = getPowerLtf()
int chartTfSec = timeframe.in_seconds()
int powerTfSec = timeframe.in_seconds(powerLtf)
string powerLtfSafe = powerTfSec <= chartTfSec ? powerLtf : timeframe.period

// Intrabar data
arrOpen = request.security_lower_tf(effectiveSymbol, powerLtfSafe, open, ignore_invalid_timeframe=true, ignore_invalid_symbol=true)
arrHigh = request.security_lower_tf(effectiveSymbol, powerLtfSafe, high, ignore_invalid_timeframe=true, ignore_invalid_symbol=true)
arrLow = request.security_lower_tf(effectiveSymbol, powerLtfSafe, low, ignore_invalid_timeframe=true, ignore_invalid_symbol=true)
arrClose = request.security_lower_tf(effectiveSymbol, powerLtfSafe, close, ignore_invalid_timeframe=true, ignore_invalid_symbol=true)
arrVol = request.security_lower_tf(effectiveSymbol, powerLtfSafe, volume, ignore_invalid_timeframe=true, ignore_invalid_symbol=true)

bool usePressure = volumeMethod == "Pressure"

calcVolume() =>
    float buyVol = 0.0
    float sellVol = 0.0
    int intrabarCount = math.min(array.size(arrVol), math.min(array.size(arrOpen), math.min(array.size(arrHigh), math.min(array.size(arrLow), array.size(arrClose)))))

    if intrabarCount > 0
        for i = 0 to intrabarCount - 1
            float o = array.get(arrOpen, i)
            float h = array.get(arrHigh, i)
            float l = array.get(arrLow, i)
            float c = array.get(arrClose, i)
            float v = array.get(arrVol, i)

            if usePressure
                float candleRange = h - l
                if candleRange > 0
                    float buyRatio = (c - l) / candleRange
                    buyVol += v * buyRatio
                    sellVol += v * (1.0 - buyRatio)
                else
                    buyVol += v * 0.5
                    sellVol += v * 0.5
            else
                if c > o
                    buyVol += v
                else if c < o
                    sellVol += v

    [buyVol, sellVol, intrabarCount]

[rawBuyVol, rawSellVol, intrabarCount] = calcVolume()

float rawTotal = rawBuyVol + rawSellVol
float rawBuyPct = rawTotal > 0 ? (rawBuyVol / rawTotal) * 100.0 : 50.0
float rawSellPct = 100.0 - rawBuyPct
float rawDelta = rawBuyVol - rawSellVol

float smoothedBuyPct = ta.ema(rawBuyPct, smoothingLen)
float smoothedSellPct = 100.0 - smoothedBuyPct

float avgTotal = ta.sma(rawTotal, avgVolumePeriod)
float vsAvg = avgTotal > 0 ? rawTotal / avgTotal : 1.0

bool isBuyDominant = smoothedBuyPct > 55
bool isSellDominant = smoothedSellPct > 55
string powerText = isBuyDominant ? "BUY" : isSellDominant ? "SELL" : "â€”"
color powerColor = isBuyDominant ? C_BULL : isSellDominant ? C_BEAR : dimColor

bool lowConfidence = intrabarCount < 4 or rawTotal == 0

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// MTF SENTIMENT
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
calcBuyPressure(float h, float l, float c, float o) =>
    float candleRange = h - l
    candleRange > 0 ? (c - l) / candleRange : (c > o ? 1.0 : c < o ? 0.0 : 0.5)

[tf1H, tf1L, tf1C, tf1O] = request.security(effectiveSymbol, tf1, [high, low, close, open], lookahead=barmerge.lookahead_off)
[tf2H, tf2L, tf2C, tf2O] = request.security(effectiveSymbol, tf2, [high, low, close, open], lookahead=barmerge.lookahead_off)
[tf3H, tf3L, tf3C, tf3O] = request.security(effectiveSymbol, tf3, [high, low, close, open], lookahead=barmerge.lookahead_off)
[tf4H, tf4L, tf4C, tf4O] = request.security(effectiveSymbol, tf4, [high, low, close, open], lookahead=barmerge.lookahead_off)

bool tf1Bull = calcBuyPressure(tf1H, tf1L, tf1C, tf1O) > 0.5
bool tf2Bull = calcBuyPressure(tf2H, tf2L, tf2C, tf2O) > 0.5
bool tf3Bull = calcBuyPressure(tf3H, tf3L, tf3C, tf3O) > 0.5
bool tf4Bull = calcBuyPressure(tf4H, tf4L, tf4C, tf4O) > 0.5

string mtfText = formatTf(tf1) + (tf1Bull ? "â–²" : "â–¼") + " " +
                 formatTf(tf2) + (tf2Bull ? "â–²" : "â–¼") + " " +
                 formatTf(tf3) + (tf3Bull ? "â–²" : "â–¼") + " " +
                 formatTf(tf4) + (tf4Bull ? "â–²" : "â–¼")

int bullCount = (tf1Bull ? 1 : 0) + (tf2Bull ? 1 : 0) + (tf3Bull ? 1 : 0) + (tf4Bull ? 1 : 0)
color mtfColor = bullCount >= 3 ? C_BULL : bullCount <= 1 ? C_BEAR : C_WARN

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// UNIFIED DASHBOARD
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
var table dash = na

if barstate.islast
    // Calculate rows needed
    int rowCount = 1  // Header always
    if showPriceRow
        rowCount += 1
    if showContextRow
        rowCount += 3  // Session, Zone, HTF
    if showVolumeRow
        rowCount += 3  // Header + Buy/Sell + Flow
    if showMtfRow
        rowCount += 1
    if showLevelsRow
        rowCount += 3  // Header + Above + Below

    if na(dash)
        dash := table.new(getDashPos(dashPosition), 4, rowCount + 1, bgcolor=bgColor, border_color=color.new(color.white, 70), border_width=1)

    table.clear(dash, 0, 0, 3, rowCount)

    txtSize = getTextSize(dashSize)
    int row = 0

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HEADER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    table.merge_cells(dash, 0, row, 3, row)
    table.cell(dash, 0, row, "â—ˆ PAGANI HUB â—ˆ", text_color=textColor, text_size=txtSize)
    row += 1

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRICE ROW
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if showPriceRow
        string symbolDisplay = getShortSymbol(effectiveSymbol)
        table.cell(dash, 0, row, symbolDisplay, text_color=textColor, text_size=txtSize)
        table.merge_cells(dash, 1, row, 3, row)
        table.cell(dash, 1, row, formatPrice(livePrice) + priceArrow, text_color=priceColor, text_size=txtSize)
        row += 1

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONTEXT ROWS (Session, Zone, HTF)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if showContextRow
        // Session
        table.cell(dash, 0, row, "Session", text_color=dimColor, text_size=txtSize)
        table.cell(dash, 1, row, sessionName, text_color=sessionColor, text_size=txtSize)
        table.cell(dash, 2, row, isMacroTime ? "MACRO" : "", text_color=C_WARN, text_size=txtSize)
        table.cell(dash, 3, row, "", text_size=txtSize)
        row += 1

        // Zone
        table.cell(dash, 0, row, "Zone", text_color=dimColor, text_size=txtSize)
        table.cell(dash, 1, row, zoneName, text_color=zoneColor, text_size=txtSize)
        table.cell(dash, 2, row, oteText, text_color=C_OTE, text_size=txtSize)
        table.cell(dash, 3, row, "", text_size=txtSize)
        row += 1

        // HTF Bias
        table.cell(dash, 0, row, "HTF " + formatTf(htfTimeframe), text_color=dimColor, text_size=txtSize)
        table.cell(dash, 1, row, biasName, text_color=biasColor, text_size=txtSize)
        table.cell(dash, 2, row, "", text_size=txtSize)
        table.cell(dash, 3, row, "", text_size=txtSize)
        row += 1

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VOLUME SECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if showVolumeRow
        // Header
        table.merge_cells(dash, 0, row, 3, row)
        table.cell(dash, 0, row, "â”€â”€ VOLUME â”€â”€", text_color=dimColor, text_size=txtSize)
        row += 1

        // Buy/Sell
        string buyText = lowConfidence ? "â€”" : str.tostring(round2(smoothedBuyPct)) + "%"
        string sellText = lowConfidence ? "â€”" : str.tostring(round2(smoothedSellPct)) + "%"
        table.cell(dash, 0, row, "Buy", text_color=C_BULL, text_size=txtSize)
        table.cell(dash, 1, row, buyText, text_color=C_BULL, text_size=txtSize)
        table.cell(dash, 2, row, "Sell", text_color=C_BEAR, text_size=txtSize)
        table.cell(dash, 3, row, sellText, text_color=C_BEAR, text_size=txtSize)
        row += 1

        // Flow + Power
        string netPrefix = rawDelta > 0 ? "+" : rawDelta < 0 ? "-" : ""
        string flowText = lowConfidence ? "â€”" : netPrefix + formatVolume(math.abs(rawDelta))
        string vsAvgText = lowConfidence ? "â€”" : str.tostring(round2(vsAvg)) + "x"
        color vsAvgColor = vsAvg >= 1.5 ? C_BULL : vsAvg <= 0.5 ? C_BEAR : textColor

        table.cell(dash, 0, row, "Flow", text_color=dimColor, text_size=txtSize)
        table.cell(dash, 1, row, flowText, text_color=rawDelta > 0 ? C_BULL : rawDelta < 0 ? C_BEAR : dimColor, text_size=txtSize)
        table.cell(dash, 2, row, "vs Avg", text_color=dimColor, text_size=txtSize)
        table.cell(dash, 3, row, vsAvgText, text_color=vsAvgColor, text_size=txtSize)
        row += 1

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MTF SENTIMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if showMtfRow
        table.cell(dash, 0, row, "MTF", text_color=dimColor, text_size=txtSize)
        table.merge_cells(dash, 1, row, 3, row)
        table.cell(dash, 1, row, mtfText, text_color=mtfColor, text_size=txtSize)
        row += 1

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEY LEVELS SECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if showLevelsRow
        // Header
        table.merge_cells(dash, 0, row, 3, row)
        table.cell(dash, 0, row, "â”€â”€ LEVELS â”€â”€", text_color=dimColor, text_size=txtSize)
        row += 1

        // Above
        if not na(nearestAbove)
            table.cell(dash, 0, row, "Above", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 1, row, nearestAboveName, text_color=C_BULL, text_size=txtSize)
            table.cell(dash, 2, row, "+" + str.tostring(distAbove) + "%", text_color=textColor, text_size=txtSize)
            table.cell(dash, 3, row, "", text_size=txtSize)
        else
            table.cell(dash, 0, row, "Above", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 1, row, "â€”", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 2, row, "", text_size=txtSize)
            table.cell(dash, 3, row, "", text_size=txtSize)
        row += 1

        // Below
        if not na(nearestBelow)
            table.cell(dash, 0, row, "Below", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 1, row, nearestBelowName, text_color=C_BEAR, text_size=txtSize)
            table.cell(dash, 2, row, "-" + str.tostring(distBelow) + "%", text_color=textColor, text_size=txtSize)
            table.cell(dash, 3, row, "", text_size=txtSize)
        else
            table.cell(dash, 0, row, "Below", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 1, row, "â€”", text_color=dimColor, text_size=txtSize)
            table.cell(dash, 2, row, "", text_size=txtSize)
            table.cell(dash, 3, row, "", text_size=txtSize)

// Invisible plot (required for overlay indicator)
plot(na, display=display.none)
