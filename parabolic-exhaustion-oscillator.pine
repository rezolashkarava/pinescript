//@version=6
indicator("Parabolic Exhaustion [Paganie] v2.3", 
     shorttitle="PE v2.3", 
     format=format.price, 
     precision=1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARABOLIC EXHAUSTION [PAGANIE] v2.3
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Professional multi-factor exhaustion detection system with:
// â€¢ Smart oscillator with continuous decay
// â€¢ Dynamic statistical thresholds
// â€¢ Divergence detection
// â€¢ Multi-timeframe validation
// â€¢ Market regime awareness
// â€¢ Actionable tiered alert system
// 
// Version: 2.3 - Complete Settings & Alerts Overhaul
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš™ï¸ SETTINGS - OPTIMIZED OUT OF THE BOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€ Signal Settings â”€â”€â”€â”€â”€â”€â”€
string G1 = "ğŸ“Š Signal Settings"

string signalMode = input.string("Balanced", "Mode", 
     options=["Conservative", "Balanced", "Aggressive"], 
     group=G1,
     tooltip="Conservative: Fewer, highest quality signals (best for volatile markets)\n" +
             "Balanced: Good mix of quality and frequency (recommended)\n" +
             "Aggressive: More signals, earlier entries (best for ranging markets)")

int smoothingPeriod = input.int(3, "Smoothing", minval=1, maxval=10, group=G1,
     tooltip="Higher values = smoother line but slower signals\n" +
             "Recommended: 2-3 for scalping, 3-5 for swing trading")

int signalCooldown = input.int(3, "Min Bars Between Signals", minval=0, maxval=20, group=G1,
     tooltip="Prevents signal spam during choppy conditions\n" +
             "0 = No filter | 3 = Balanced | 10+ = Very strict")

// â”€â”€â”€â”€â”€â”€â”€ Filters â”€â”€â”€â”€â”€â”€â”€
string G2 = "ğŸ” Filters"

bool useMultiTimeframe = input.bool(true, "Higher Timeframe Check", group=G2,
     tooltip="Validates signals against higher timeframe trend\n" +
             "Reduces false signals but may miss some opportunities\n" +
             "Recommended: ON for trend trading, OFF for mean reversion")

bool useTrendFilter = input.bool(false, "Trend Filter (EMA 50/200)", group=G2,
     tooltip="Only shows signals aligned with major trend\n" +
             "OFF = All signals | ON = Only with-trend signals\n" +
             "Recommended: OFF for most trading, ON for strict trend following")

bool showDivergences = input.bool(false, "Divergence Alerts", group=G2,
     tooltip="Detects price/oscillator divergences (advanced feature)\n" +
             "Generates separate alerts but no visual markers")

// â”€â”€â”€â”€â”€â”€â”€ Alert Preferences â”€â”€â”€â”€â”€â”€â”€
string G2A = "ğŸ”” Alert Preferences"

bool alertPremiumSignals = input.bool(true, "ğŸ”¥ Premium Signals", group=G2A, inline="a1",
     tooltip="Highest quality signals - recommended for all traders")
bool alertHighSignals = input.bool(true, "âš¡ High Quality Signals", group=G2A, inline="a1")

bool alertStandardSignals = input.bool(false, "âœ“ Standard Signals", group=G2A, inline="a2",
     tooltip="Lower confidence signals - can be noisy, OFF by default")
bool alertZoneWarnings = input.bool(false, "ğŸ“ Zone Warnings", group=G2A, inline="a2",
     tooltip="Advance notice when entering overbought/oversold - optional")

// â”€â”€â”€â”€â”€â”€â”€ Display â”€â”€â”€â”€â”€â”€â”€
string G3 = "ğŸ¨ Display"

color bullishColor = input.color(#00C896, 'Bullish', group=G3, inline="c1")
color bearishColor = input.color(#FF5252, 'Bearish', group=G3, inline="c1")

bool showThresholdZones = input.bool(true, "Show Threshold Zones", group=G3,
     tooltip="Display overbought/oversold zone markers (dotted circles)")

// â”€â”€â”€â”€â”€â”€â”€ Advanced (Rarely Changed) â”€â”€â”€â”€â”€â”€â”€
string G4 = "âš™ï¸ Advanced"

bool autoTimeframeAdapt = input.bool(true, "Auto Timeframe Optimization", group=G4,
     tooltip="Automatically adjusts all parameters for your current timeframe\n" +
             "Recommended: Always keep ON unless you have specific parameter values")

int minimumScoreOverride = input.int(0, "Min Score Override", minval=0, maxval=9, group=G4,
     tooltip="Manual override for minimum score requirement\n" +
             "0 = Auto (recommended) | 4-6 = Custom threshold\n" +
             "Higher = fewer signals but higher quality")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADAPTIVE PARAMETERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Map signal mode to sensitivity values
int sensitivity = signalMode == "Conservative" ? 60 : signalMode == "Aggressive" ? 80 : 70
string signalQuality = signalMode == "Conservative" ? "Premium" : signalMode == "Aggressive" ? "All" : "High"

int tfMinutes = timeframe.in_seconds() / 60
float tfMultiplier = math.sqrt(tfMinutes / 15.0)
float sensitivityFactor = 1.0 + ((sensitivity - 70) / 100.0)

float thresholdMultiplier = 
     tfMinutes <= 1 ? 1.8 * sensitivityFactor :
     tfMinutes <= 5 ? 1.3 * sensitivityFactor :
     tfMinutes <= 15 ? 1.0 * sensitivityFactor :
     tfMinutes <= 60 ? 0.85 * sensitivityFactor :
     0.75 * sensitivityFactor

int velocityPeriod = autoTimeframeAdapt ? int(math.max(2, math.round(4 * tfMultiplier))) : 4
float velocityThreshold = autoTimeframeAdapt ? 1.8 * thresholdMultiplier : 1.8
int atrPeriod = autoTimeframeAdapt ? int(math.max(7, math.round(14 * tfMultiplier))) : 14
float minWickRatio = autoTimeframeAdapt ? 0.4 * thresholdMultiplier : 0.4
float minCandleSize = autoTimeframeAdapt ? 0.6 * thresholdMultiplier : 0.6
int rocPeriod = autoTimeframeAdapt ? int(math.max(2, math.round(6 * tfMultiplier))) : 6
int rocLookback = autoTimeframeAdapt ? int(math.max(30, math.round(100 * tfMultiplier))) : 100
int volPeriod = autoTimeframeAdapt ? int(math.max(8, math.round(20 * tfMultiplier))) : 20
int priceExtremeLookback = autoTimeframeAdapt ? int(math.max(20, math.round(35 * tfMultiplier))) : 35

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKET REGIME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float atr = ta.atr(atrPeriod)
float atrPercent = (atr / close) * 100

[diPlus, diMinus, adx] = ta.dmi(14, 14)
bool isTrending = adx > 25
bool isHighVolatility = atrPercent > 2.0

float ema50 = ta.ema(close, 50)
float ema200 = ta.ema(close, 200)
bool bullishRegime = ema50 > ema200
bool bearishRegime = ema50 < ema200

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Price Velocity
priceChange = close - close[velocityPeriod]
priceVelocity = atr > 0 ? math.abs(priceChange) / atr : 0
bool parabolicUp = priceChange > 0 and priceVelocity >= velocityThreshold
bool parabolicDown = priceChange < 0 and priceVelocity >= velocityThreshold

// Reversal Candles
float bodySize = math.abs(close - open)
float upperWick = high - math.max(close, open)
float lowerWick = math.min(close, open) - low
float candleRange = high - low
bool isBullishCandle = close > open
bool isBearishCandle = close < open

bool shootingStar = isBearishCandle and upperWick >= bodySize * minWickRatio and candleRange >= minCandleSize * atr
bool hammer = isBullishCandle and lowerWick >= bodySize * minWickRatio and candleRange >= minCandleSize * atr
bool bearishReversalCandle = shootingStar or (upperWick >= lowerWick * 2 and upperWick >= bodySize and candleRange >= minCandleSize * atr)
bool bullishReversalCandle = hammer or (lowerWick >= upperWick * 2 and lowerWick >= bodySize and candleRange >= minCandleSize * atr)

// ROC Extreme
roc = 100 * (close - close[rocPeriod]) / close[rocPeriod]
rocPercentile = ta.percentrank(roc, rocLookback)
bool rocExtremeBullish = rocPercentile <= 15
bool rocExtremeBearish = rocPercentile >= 85

// Volume with percentile
volMa = ta.sma(volume, volPeriod)
float volPercentile = ta.percentrank(volume, 100)
bool volumeClimax = volume >= volMa * 1.3
bool exceptionalVolume = volPercentile >= 95
// Cap weight at 1.0 to prevent score inflation
float volumeWeight = math.min(exceptionalVolume ? 1.5 : volumeClimax ? 1.0 : 0.5, 1.0)

// Momentum
float prevVelocity1 = atr[1] > 0 ? math.abs(close[1] - close[1 + velocityPeriod]) / atr[1] : 0
float prevVelocity2 = atr[2] > 0 ? math.abs(close[2] - close[2 + velocityPeriod]) / atr[2] : 0
bool velocityDecreasing = priceVelocity < prevVelocity1 and priceVelocity < ((prevVelocity1 + prevVelocity2) / 2)

// Price Extremes
float priceHigh = ta.highest(high, priceExtremeLookback)
float priceLow = ta.lowest(low, priceExtremeLookback)
bool nearHighExtreme = atr > 0 and high >= (priceHigh - (0.7 * atr))
bool nearLowExtreme = atr > 0 and low <= (priceLow + (0.7 * atr))

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float longScore = 0.0
if parabolicDown
    longScore += 2.0
if bullishReversalCandle
    longScore += 2.0
if parabolicDown and bullishReversalCandle
    longScore += 1.0
if rocExtremeBullish
    longScore += 1.0
if volumeClimax or exceptionalVolume
    longScore += 1.0 * volumeWeight
if velocityDecreasing
    longScore += 1.0
if nearLowExtreme
    longScore += 1.0

float shortScore = 0.0
if parabolicUp
    shortScore += 2.0
if bearishReversalCandle
    shortScore += 2.0
if parabolicUp and bearishReversalCandle
    shortScore += 1.0
if rocExtremeBearish
    shortScore += 1.0
if volumeClimax or exceptionalVolume
    shortScore += 1.0 * volumeWeight
if velocityDecreasing
    shortScore += 1.0
if nearHighExtreme
    shortScore += 1.0

longScore := math.min(longScore, 9.0)
shortScore := math.min(shortScore, 9.0)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OSCILLATOR - FULL RANGE UTILIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float rawOscillator = 50.0

// Move oscillator based on score strength (uses full 0-100 range)
if parabolicDown and longScore >= 3  // Lower threshold for movement
    rawOscillator := 50.0 - (longScore / 9.0 * 50.0)
else if parabolicUp and shortScore >= 3  // Lower threshold for movement
    rawOscillator := 50.0 + (shortScore / 9.0 * 50.0)
else if longScore > 0 and not parabolicUp  // Show building exhaustion
    rawOscillator := 50.0 - (longScore / 9.0 * 20.0)  // Partial movement (20% of range)
else if shortScore > 0 and not parabolicDown  // Show building exhaustion
    rawOscillator := 50.0 + (shortScore / 9.0 * 20.0)  // Partial movement (20% of range)
else
    // Quick decay back to neutral
    rawOscillator := na(rawOscillator[1]) ? 50.0 : 
                     math.abs(rawOscillator[1] - 50.0) < 2 ? 50.0 :
                     rawOscillator[1] * 0.70 + 50.0 * 0.30  // Faster decay

float oscillator = smoothingPeriod > 1 ? ta.ema(rawOscillator, smoothingPeriod) : rawOscillator

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DYNAMIC THRESHOLDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float volatilityAdj = isHighVolatility ? 1.2 : 1.0
float baseZone = 20.0 * volatilityAdj

float upperZone = 50 + baseZone
float lowerZone = 50 - baseZone

bool inOverbought = oscillator >= upperZone
bool inOversold = oscillator <= lowerZone

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIVERGENCE DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

int divLookback = 5
float oscPivotLow = ta.pivotlow(oscillator, divLookback, divLookback)
float oscPivotHigh = ta.pivothigh(oscillator, divLookback, divLookback)
float pricePivotLow = ta.pivotlow(low, divLookback, divLookback)
float pricePivotHigh = ta.pivothigh(high, divLookback, divLookback)

var float lastOscLow = na
var float lastPriceLow = na
var float lastOscHigh = na
var float lastPriceHigh = na

if not na(oscPivotLow)
    lastOscLow := oscPivotLow
    lastPriceLow := pricePivotLow

if not na(oscPivotHigh)
    lastOscHigh := oscPivotHigh
    lastPriceHigh := pricePivotHigh

bool bullishDivergence = not na(lastOscLow) and not na(oscPivotLow) and 
     pricePivotLow < lastPriceLow and oscPivotLow > lastOscLow

bool bearishDivergence = not na(lastOscHigh) and not na(oscPivotHigh) and 
     pricePivotHigh > lastPriceHigh and oscPivotHigh < lastOscHigh

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MULTI-TIMEFRAME VALIDATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string htf = timeframe.period == "1" ? "5" : 
             timeframe.period == "5" ? "15" :
             timeframe.period == "15" ? "60" :
             timeframe.period == "60" ? "240" : "D"

[htfOsc, htfTrend] = request.security(syminfo.tickerid, htf, 
    [oscillator, ema50 > ema200], lookahead=barmerge.lookahead_off)

bool htfSupportsLong = useMultiTimeframe ? (htfOsc < 60 or htfTrend) : true
bool htfSupportsShort = useMultiTimeframe ? (htfOsc > 40 or not htfTrend) : true

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIRMATION LAYERS (Dynamic based on signal quality setting)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float rsi = ta.rsi(close, 14)

// Layer 1: Core score (matches min score requirement)
int minScoreForLayer1 = signalQuality == "Premium" ? 6 : signalQuality == "High" ? 5 : 4

bool longLayer1 = longScore >= minScoreForLayer1
bool longLayer2 = nearLowExtreme or bullishReversalCandle
bool longLayer3 = volumeClimax or exceptionalVolume
bool longLayer4 = rsi < 35 or bullishDivergence

int longConfirmations = (longLayer1 ? 1 : 0) + (longLayer2 ? 1 : 0) + 
                         (longLayer3 ? 1 : 0) + (longLayer4 ? 1 : 0)

bool shortLayer1 = shortScore >= minScoreForLayer1
bool shortLayer2 = nearHighExtreme or bearishReversalCandle
bool shortLayer3 = volumeClimax or exceptionalVolume
bool shortLayer4 = rsi > 65 or bearishDivergence

int shortConfirmations = (shortLayer1 ? 1 : 0) + (shortLayer2 ? 1 : 0) + 
                          (shortLayer3 ? 1 : 0) + (shortLayer4 ? 1 : 0)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNALS (Optimized Out of the Box)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Determine min score based on mode (or use override)
int minScoreBase = signalQuality == "Premium" ? 6 : signalQuality == "High" ? 5 : 4
int minScoreRequired = minimumScoreOverride > 0 ? minimumScoreOverride : minScoreBase

int longConfidence = longScore >= 7 ? 3 : longScore >= 5 ? 2 : longScore >= 4 ? 1 : 0
int shortConfidence = shortScore >= 7 ? 3 : shortScore >= 5 ? 2 : shortScore >= 4 ? 1 : 0

// Trend filter (optional - OFF by default for more opportunities)
bool trendOkLong = useTrendFilter ? (not bearishRegime or bullishDivergence) : true
bool trendOkShort = useTrendFilter ? (not bullishRegime or bearishDivergence) : true

// Confirmation requirement: 2 of 4 layers (balanced)
// Core setup: Score + 2 confirmations + parabolic move + filters
bool longSetup = longScore >= minScoreRequired and longConfirmations >= 2 and 
     parabolicDown and trendOkLong and htfSupportsLong

bool shortSetup = shortScore >= minScoreRequired and shortConfirmations >= 2 and 
     parabolicUp and trendOkShort and htfSupportsShort

var int lastSignalBar = na
bool cooldownOk = signalCooldown == 0 or na(lastSignalBar) or (bar_index - lastSignalBar) > signalCooldown

bool longSignal = longSetup and cooldownOk and longScore >= shortScore and barstate.isconfirmed
bool shortSignal = shortSetup and cooldownOk and shortScore > longScore and barstate.isconfirmed

if longSignal or shortSignal
    lastSignalBar := bar_index

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERFORMANCE TRACKING (Last 20 Signals)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var array<float> signalPrices = array.new<float>(0)
var array<int> signalDirections = array.new<int>(0)  // 1 for long, -1 for short
var array<int> signalBars = array.new<int>(0)

// Record new signal
if longSignal
    array.push(signalPrices, close)
    array.push(signalDirections, 1)
    array.push(signalBars, bar_index)
    if array.size(signalPrices) > 20
        array.shift(signalPrices)
        array.shift(signalDirections)
        array.shift(signalBars)

if shortSignal
    array.push(signalPrices, close)
    array.push(signalDirections, -1)
    array.push(signalBars, bar_index)
    if array.size(signalPrices) > 20
        array.shift(signalPrices)
        array.shift(signalDirections)
        array.shift(signalBars)

// Performance tracking - count total signals generated
var int totalSignals = 0

// Update counter on new signals
if longSignal or shortSignal
    totalSignals += 1

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLEAN PROFESSIONAL VISUALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Reference Lines
plot(100, 'Upper Bound', color.new(bearishColor, 85), 1)
plot(showThresholdZones ? upperZone : na, 'Overbought Zone', color.new(bearishColor, 80), 1, plot.style_circles)
plot(50, 'Centerline', color.new(color.gray, 85), 1)
plot(showThresholdZones ? lowerZone : na, 'Oversold Zone', color.new(bullishColor, 80), 1, plot.style_circles)
plot(0, 'Lower Bound', color.new(bullishColor, 85), 1)

// Main Line - clean color coding with intensity
color lineColor = 
     oscillator >= upperZone ? bearishColor :
     oscillator <= lowerZone ? bullishColor :
     oscillator > 50 ? color.new(bearishColor, 50) :
     oscillator < 50 ? color.new(bullishColor, 50) :
     color.new(color.gray, 30)

// Main oscillator line
plot(oscillator, "PE v2.3", lineColor, 2)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ACTIONABLE ALERTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ¯ PRIMARY TRADING SIGNALS (Recommended for trading)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Premium Quality Signals (Highest probability - use for main entries)
alertcondition(alertPremiumSignals and longSignal and longConfidence == 3, "ğŸ”¥ PREMIUM Long", "ğŸ”¥ PREMIUM LONG SIGNAL\n\nğŸ¯ Action: Consider LONG entry\nâ­ Quality: Premium (Highest)\nğŸ“Š All confirmations aligned\n\nâœ… Check your strategy rules before entering")

alertcondition(alertPremiumSignals and shortSignal and shortConfidence == 3, "ğŸ”¥ PREMIUM Short", "ğŸ”¥ PREMIUM SHORT SIGNAL\n\nğŸ¯ Action: Consider SHORT entry\nâ­ Quality: Premium (Highest)\nğŸ“Š All confirmations aligned\n\nâœ… Check your strategy rules before entering")

// High Quality Signals (Strong probability - reliable for trading)
alertcondition(alertHighSignals and longSignal and longConfidence == 2, "âš¡ HIGH Quality Long", "âš¡ HIGH QUALITY LONG\n\nğŸ¯ Action: Consider LONG entry\nâ­ Quality: High\nğŸ“Š Strong exhaustion detected\n\nâœ… Verify price action before entering")

alertcondition(alertHighSignals and shortSignal and shortConfidence == 2, "âš¡ HIGH Quality Short", "âš¡ HIGH QUALITY SHORT\n\nğŸ¯ Action: Consider SHORT entry\nâ­ Quality: High\nğŸ“Š Strong exhaustion detected\n\nâœ… Verify price action before entering")

// Standard Signals (Valid but lower confidence - use with caution)
alertcondition(alertStandardSignals and longSignal and longConfidence <= 1, "âœ“ Standard Long", "âœ“ STANDARD LONG SIGNAL\n\nğŸ¯ Action: Consider LONG (lower confidence)\nâ­ Quality: Standard\nâš ï¸ Wait for additional confirmation recommended\n\nğŸ’¡ Use smaller position or wait for premium signal")

alertcondition(alertStandardSignals and shortSignal and shortConfidence <= 1, "âœ“ Standard Short", "âœ“ STANDARD SHORT SIGNAL\n\nğŸ¯ Action: Consider SHORT (lower confidence)\nâ­ Quality: Standard\nâš ï¸ Wait for additional confirmation recommended\n\nğŸ’¡ Use smaller position or wait for premium signal")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸš¨ ZONE ALERTS (Market conditions - useful for context)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

bool enteringOverbought = ta.cross(oscillator, upperZone) and oscillator > upperZone
bool enteringOversold = ta.cross(oscillator, lowerZone) and oscillator < lowerZone
bool extremeOverbought = oscillator >= 85
bool extremeOversold = oscillator <= 15

alertcondition(alertZoneWarnings and enteringOversold, "ğŸ“ Oversold Zone", "ğŸ“ OVERSOLD ZONE REACHED\n\nğŸ’¡ Market showing downside exhaustion\nğŸ” Watch for reversal signals\nâ° Potential long opportunity building\n\nâš ï¸ Wait for actual signal before entering")

alertcondition(alertZoneWarnings and enteringOverbought, "ğŸ“ Overbought Zone", "ğŸ“ OVERBOUGHT ZONE REACHED\n\nğŸ’¡ Market showing upside exhaustion\nğŸ” Watch for reversal signals\nâ° Potential short opportunity building\n\nâš ï¸ Wait for actual signal before entering")

alertcondition(alertZoneWarnings and extremeOversold, "ğŸ”´ EXTREME Oversold", "ğŸ”´ EXTREME OVERSOLD\n\nâš¡ Severe downside exhaustion detected\nğŸ“ˆ High probability reversal zone\nğŸ¯ Prepare for potential long signal\n\nğŸ’¡ This is advance warning - signal may follow soon")

alertcondition(alertZoneWarnings and extremeOverbought, "ğŸ”´ EXTREME Overbought", "ğŸ”´ EXTREME OVERBOUGHT\n\nâš¡ Severe upside exhaustion detected\nğŸ“‰ High probability reversal zone\nğŸ¯ Prepare for potential short signal\n\nğŸ’¡ This is advance warning - signal may follow soon")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ“Š DIVERGENCE ALERTS (Advanced - enable in settings if needed)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

alertcondition(showDivergences and bullishDivergence, "ğŸ”„ Bullish Divergence", "ğŸ”„ BULLISH DIVERGENCE DETECTED\n\nğŸ“Š Price making lower lows\nğŸ“ˆ Oscillator making higher lows\nğŸ’¡ Potential trend reversal building\n\nâš ï¸ Divergence is early warning - wait for signal")

alertcondition(showDivergences and bearishDivergence, "ğŸ”„ Bearish Divergence", "ğŸ”„ BEARISH DIVERGENCE DETECTED\n\nğŸ“Š Price making higher highs\nğŸ“‰ Oscillator making lower highs\nğŸ’¡ Potential trend reversal building\n\nâš ï¸ Divergence is early warning - wait for signal")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ² QUICK REFERENCE: Alert Hierarchy
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// For Trading:
//   1. ğŸ”¥ PREMIUM signals â†’ Highest confidence, primary entries
//   2. âš¡ HIGH signals â†’ Strong signals, reliable for trading
//   3. âœ“ STANDARD signals â†’ Valid but use caution / smaller size
//
// For Context:
//   â€¢ ğŸ“ Zone alerts â†’ Market reaching exhaustion areas (advance notice)
//   â€¢ ğŸ”´ EXTREME â†’ Very rare, high probability setups approaching
//   â€¢ ğŸ”„ Divergence â†’ Early reversal warning (needs confirmation)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// END - Parabolic Exhaustion [Paganie] v2.3
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
