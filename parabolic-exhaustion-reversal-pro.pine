//@version=6
indicator("Parabolic Exhaustion Reversal Pro [Paganie] v5.2", shorttitle="PE-RP v5.2", format=format.price, precision=1)

// Targeted max_bars_back for series used in large lookbacks (percentrank, BBW, etc.)
max_bars_back(close, 1200)
max_bars_back(high, 1200)
max_bars_back(low, 1200)
max_bars_back(volume, 1200)

// ============================================================================
// PARABOLIC EXHAUSTION REVERSAL PRO v5.2
// Detects parabolic price exhaustion for potential reversal signals
// Auto-adapts: TF <= 15m = Scalp mode, TF > 15m = Swing mode
//
// V5.2 - Enhanced Signal Detection and Accuracy:
// â€¢ Tightened shooting star/hammer wick ratio (1.5x/2.0x body, academic standard)
// â€¢ Added Bollinger Band Width percentile exhaustion gate
// â€¢ Added Z-score of returns as statistical overextension measure
// â€¢ Added ADX peak exhaustion signal (ADX > 45 declining)
// â€¢ Added Three Outside Up/Down pattern (~70% win rate)
// â€¢ Added Wyckoff absorption detection (climactic volume + close reversal)
// ============================================================================

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INPUTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

string GRP_SIG = "ğŸ“Š Signal Settings"
string GRP_FLT = "ğŸ” Filters"
string GRP_ALT = "ğŸ”” Alert Preferences"
string GRP_VIS = "ğŸ¨ Display"
string GRP_ADV = "âš™ï¸ Advanced"

// Signal Settings
string modeInput    = input.string("Auto", "Mode", options=["Auto", "Scalp", "Swing"], group=GRP_SIG, tooltip="Auto: <=15m scalp, >15m swing")
string signalMode   = input.string("Balanced", "Sensitivity", options=["Conservative", "Balanced", "Aggressive"], group=GRP_SIG, tooltip="Conservative: fewer but higher quality\nBalanced: optimal balance\nAggressive: more signals, lower threshold")
int smoothingPeriod = input.int(3, "Smoothing", minval=1, maxval=10, group=GRP_SIG, tooltip="Oscillator smoothing (1=raw, higher=smoother)")
int signalCooldown  = input.int(5, "Min Bars Between Signals", minval=0, maxval=50, group=GRP_SIG, tooltip="Prevents signal spam")

// Filters
bool useMultiTimeframe   = input.bool(true, "Higher Timeframe Alignment", group=GRP_FLT, tooltip="Validates signals against HTF trend/RSI")
bool useTrendFilter      = input.bool(true, "Trend Filter (EMA 50/200)", group=GRP_FLT, tooltip="Filters out weak counter-trend setups")
bool showDivergences     = input.bool(true, "RSI Divergence Detection", group=GRP_FLT)
bool useVolatilityFilter = input.bool(true, "Low-Volatility Filter", group=GRP_FLT, tooltip="Blocks signals when ATR% is too low")
bool useChopFilterSwing  = input.bool(true, "Chop Filter (Swing Only)", group=GRP_FLT, tooltip="Blocks reversals in choppy structure")

// Alert Preferences
bool alertPremiumSignals  = input.bool(true, "ğŸ”¥ Premium Signals", group=GRP_ALT, inline="a1")
bool alertHighSignals     = input.bool(true, "âš¡ High Quality Signals", group=GRP_ALT, inline="a1")
bool alertStandardSignals = input.bool(false, "âœ“ Standard Signals", group=GRP_ALT, inline="a2")
bool alertZoneWarnings    = input.bool(false, "ğŸ“ Zone Warnings", group=GRP_ALT, inline="a2")

// Display
color bullishColor      = input.color(#00C896, "Bullish", group=GRP_VIS, inline="c1")
color bearishColor      = input.color(#FF5252, "Bearish", group=GRP_VIS, inline="c1")
bool showThresholdZones = input.bool(true, "Show Threshold Zones", group=GRP_VIS)
bool showSignalMarkers  = input.bool(true, "Show Signal Markers", group=GRP_VIS, tooltip="Visual markers for long/short signals")

// Advanced
bool autoTimeframeAdapt              = input.bool(true, "Auto Timeframe Optimization", group=GRP_ADV)
int minimumScoreOverride             = input.int(0, "Min Score Override", minval=0, maxval=15, group=GRP_ADV)
float lowVolCutoffOverride           = input.float(0.0, "ATR% Cutoff Override", minval=0.0, step=0.05, group=GRP_ADV)
int confirmationsOverride            = input.int(0, "Confirmations Override", minval=0, maxval=5, group=GRP_ADV)
bool extraConfirmationInChop         = input.bool(true, "Extra Confirmation In Chop", group=GRP_ADV)
bool requireReversalCandleConservative = input.bool(true, "Require Reversal Candle (Conservative)", group=GRP_ADV)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODE & THRESHOLDS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

int tfMinutes      = timeframe.in_seconds() / 60
float tfMultiplier = math.sqrt(tfMinutes / 15.0)
bool isScalp       = modeInput == "Auto" ? tfMinutes <= 15 : modeInput == "Scalp"

int sensitivity        = signalMode == "Conservative" ? 60 : signalMode == "Aggressive" ? 80 : 70
float sensitivityFactor = 1.0 + ((sensitivity - 70) / 100.0)

// Pre-computed thresholds (scalp vs swing)
float T_ADX           = isScalp ? 23.0 : 25.0
float T_ER            = isScalp ? 0.45 : 0.50
float T_CHOP          = isScalp ? 55.0 : 52.0
float T_VOL           = isScalp ? 1.2  : 1.6
float T_WICK          = isScalp ? 1.5  : 2.0
float T_MIN_RANGE     = isScalp ? 0.55 : 0.70
float T_EXTREME_ATR   = isScalp ? 0.8  : 0.7
float T_RSI_LOW       = isScalp ? 38.0 : 42.0
float T_RSI_HIGH      = isScalp ? 62.0 : 58.0
float T_ROC_LOW       = isScalp ? 18.0 : 15.0
float T_ROC_HIGH      = isScalp ? 82.0 : 85.0
float T_PENALTY       = isScalp ? 0.8  : 1.5
float T_PRICE_EXTREME = isScalp ? 0.7  : 1.0

float thresholdMultiplier = tfMinutes <= 1 ? 1.8 * sensitivityFactor : tfMinutes <= 5 ? 1.3 * sensitivityFactor : tfMinutes <= 15 ? 1.0 * sensitivityFactor : tfMinutes <= 60 ? 0.85 * sensitivityFactor : 0.75 * sensitivityFactor

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADAPTIVE PARAMETERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

int atrPeriod       = autoTimeframeAdapt ? int(math.max(7, math.round(14 * tfMultiplier))) : 14
int velocityPeriod  = autoTimeframeAdapt ? int(math.max(2, math.round((isScalp ? 3 : 5) * tfMultiplier))) : (isScalp ? 3 : 5)
int rocPeriod       = autoTimeframeAdapt ? int(math.max(2, math.round((isScalp ? 6 : 10) * tfMultiplier))) : (isScalp ? 6 : 10)
int rocLookback     = autoTimeframeAdapt ? int(math.max(40, math.round((isScalp ? 120 : 180) * tfMultiplier))) : (isScalp ? 120 : 180)
int volRankLen      = autoTimeframeAdapt ? int(math.max(100, math.round(200 * tfMultiplier))) : 200
int volMaLen        = autoTimeframeAdapt ? int(math.max(10, math.round(20 * tfMultiplier))) : 20
int extremeLookback = autoTimeframeAdapt ? int(math.max(20, math.round((isScalp ? 35 : 55) * tfMultiplier))) : (isScalp ? 35 : 55)
int dmiLen          = autoTimeframeAdapt ? int(math.max(10, math.round(14 * tfMultiplier))) : 14
int erLen           = autoTimeframeAdapt ? int(math.max(8, math.round((isScalp ? 10 : 20) * tfMultiplier))) : (isScalp ? 10 : 20)
int chopLen         = autoTimeframeAdapt ? int(math.max(10, math.round((isScalp ? 14 : 20) * tfMultiplier))) : (isScalp ? 14 : 20)
int divLookback     = autoTimeframeAdapt ? (isScalp ? 5 : int(math.max(5, math.min(12, math.round(8 * tfMultiplier))))) : 7
int bbLen           = autoTimeframeAdapt ? int(math.max(14, math.round(20 * tfMultiplier))) : 20
int zScoreLen       = autoTimeframeAdapt ? int(math.max(14, math.round((isScalp ? 20 : 30) * tfMultiplier))) : (isScalp ? 20 : 30)

float velocityThreshold = (isScalp ? 1.7 : 1.9) * thresholdMultiplier

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CORE CALCULATIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float atr        = ta.atr(atrPeriod)
float atrPercent = close != 0 ? (atr / close) * 100 : 0

[diPlus, diMinus, adx] = ta.dmi(dmiLen, dmiLen)

float erDen = math.sum(math.abs(ta.change(close)), erLen)
float er    = erDen != 0 ? math.abs(close - close[erLen]) / erDen : 0

float trSum      = math.sum(ta.tr(true), chopLen)
float chopHigh   = ta.highest(high, chopLen)
float chopLow    = ta.lowest(low, chopLen)
float rangeN     = chopHigh - chopLow
float logChopLen = math.log10(chopLen)
float chop       = rangeN > 0 and trSum > 0 and chopLen > 1 ? 100 * math.log10(trSum / rangeN) / logChopLen : 100

bool isTrending      = adx > T_ADX and er > T_ER and chop < T_CHOP
bool isHighVolatility = atrPercent > T_VOL

float ema50  = ta.ema(close, 50)
float ema200 = ta.ema(close, 200)
bool bullishRegime = ema50 > ema200
bool bearishRegime = ema50 < ema200

float lowVolCutoff     = lowVolCutoffOverride > 0 ? lowVolCutoffOverride : (autoTimeframeAdapt ? (tfMinutes <= 5 ? 0.25 : tfMinutes <= 60 ? 0.35 : 0.5) : 0.35)
bool volatilityFilterOk = not useVolatilityFilter or signalMode == "Aggressive" or atrPercent >= lowVolCutoff
bool chopOk             = isScalp or not useChopFilterSwing or chop < (autoTimeframeAdapt ? (tfMinutes <= 60 ? 61 : 58) : 60)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VELOCITY & ACCELERATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float priceChange    = close - close[velocityPeriod]
float priceVelocity  = atr > 0 ? math.abs(priceChange) / atr : 0
bool parabolicUp     = priceChange > 0 and priceVelocity >= velocityThreshold
bool parabolicDown   = priceChange < 0 and priceVelocity >= velocityThreshold

float velocitySma      = ta.sma(priceVelocity, 5)
float acceleration     = priceVelocity - velocitySma
float prevAccel1       = nz(acceleration[1])
float prevAccel2       = nz(acceleration[2])
bool accelNegative     = acceleration < 0
bool velocityDecreasing = (priceChange > 0 and accelNegative and acceleration < prevAccel1) or
                          (priceChange < 0 and accelNegative and acceleration < prevAccel1) or
                          (accelNegative and prevAccel1 < 0 and prevAccel2 < 0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BOLLINGER BAND WIDTH PERCENTILE (v5.2)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float bbBasis  = ta.sma(close, bbLen)
float bbStdev  = ta.stdev(close, bbLen)
float bbWidth  = bbStdev > 0 and bbBasis > 0 ? (bbStdev * 2) / bbBasis * 100 : 0
float bbwPctRank = ta.percentrank(bbWidth, math.max(50, bbLen * 5))
bool bbwExtreme  = bbwPctRank >= 90

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Z-SCORE OF RETURNS (v5.2)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float zMean    = ta.sma(close, zScoreLen)
float zStdev   = ta.stdev(close, zScoreLen)
float zScore   = zStdev > 0 ? (close - zMean) / zStdev : 0.0
bool zExtHigh  = zScore >= 2.5
bool zExtLow   = zScore <= -2.5

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CANDLE PATTERNS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float bodySize     = math.abs(close - open)
float upperWick    = high - math.max(close, open)
float lowerWick    = math.min(close, open) - low
float candleRange  = high - low
float minCandleRng = T_MIN_RANGE * thresholdMultiplier * atr

bool isBullish = close > open
bool isBearish = close < open

// Shooting star / hammer use strict wick ratio (1.5x-2.0x body per academic standard)
bool shootingStar      = isBearish and upperWick >= bodySize * T_WICK and lowerWick < bodySize * 0.3 and candleRange >= minCandleRng
bool hammer            = isBullish and lowerWick >= bodySize * T_WICK and upperWick < bodySize * 0.3 and candleRange >= minCandleRng
// Long wick patterns use looser ratio (dominant wick direction)
bool bearishWickPat    = upperWick >= lowerWick * 2 and upperWick >= bodySize and candleRange >= minCandleRng
bool bullishWickPat    = lowerWick >= upperWick * 2 and lowerWick >= bodySize and candleRange >= minCandleRng

float prevBodySize     = math.abs(close[1] - open[1])
bool bullishEngulfing  = isBullish and close[1] < open[1] and close > open[1] and open <= close[1] and bodySize > prevBodySize * 1.1 and bodySize >= atr * 0.4
bool bearishEngulfing  = isBearish and close[1] > open[1] and close < open[1] and open >= close[1] and bodySize > prevBodySize * 1.1 and bodySize >= atr * 0.4

// Three Outside Up/Down (v5.2) â€” engulfing confirmed by 3rd bar closing beyond
bool threeOutsideUp   = bullishEngulfing[1] and isBullish and close > high[1]
bool threeOutsideDown = bearishEngulfing[1] and isBearish and close < low[1]

bool isDoji            = bodySize <= candleRange * 0.1 and candleRange >= atr * 0.5
bool bearishReversalCandle = shootingStar or bearishWickPat or bearishEngulfing or threeOutsideDown or (isDoji and upperWick > lowerWick * 1.5)
bool bullishReversalCandle = hammer or bullishWickPat or bullishEngulfing or threeOutsideUp or (isDoji and lowerWick > upperWick * 1.5)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ROC & VOLUME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float roc            = close[rocPeriod] != 0 ? 100 * (close - close[rocPeriod]) / close[rocPeriod] : 0
float rocPercentile  = ta.percentrank(roc, rocLookback)
bool rocExtremeBull  = rocPercentile <= T_ROC_LOW
bool rocExtremeBear  = rocPercentile >= T_ROC_HIGH

float volSma5        = ta.sma(volume, 5)
float volSma20       = ta.sma(volume, 20)
float volMa          = volMaLen == 20 ? volSma20 : ta.sma(volume, volMaLen)
float volPercentile  = ta.percentrank(volume, volRankLen)

bool volumeClimax       = volume >= volMa * 1.5
bool volumeClimaxStrong = volume >= volMa * 2.0
bool exceptionalVolume  = volPercentile >= 95
bool hasVolumeSignal    = volumeClimax or exceptionalVolume
bool volumeDeclining    = volSma5 < volSma20 * 0.75
float volumeWeight      = volumeClimaxStrong ? 2.0 : exceptionalVolume ? 1.8 : volumeClimax ? 1.5 : 1.0

float recent10High = ta.highest(high, 10)
float recent10Low  = ta.lowest(low, 10)
bool bearishVolDiv = high >= recent10High[1] * 0.998 and volumeDeclining and not volumeClimax
bool bullishVolDiv = low <= recent10Low[1] * 1.002 and volumeDeclining and not volumeClimax

// Wyckoff absorption detection (v5.2): climactic volume bar closing opposite to trend
float closeLoc = candleRange > 0 ? (close - low) / candleRange : 0.5
bool wyckoffAbsorptionBull = volumeClimaxStrong and parabolicDown and closeLoc >= 0.6
bool wyckoffAbsorptionBear = volumeClimaxStrong and parabolicUp and closeLoc <= 0.4

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PRICE EXTREMES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float priceHigh       = ta.highest(high, extremeLookback)
float priceLow        = ta.lowest(low, extremeLookback)
float extremeOffset   = T_EXTREME_ATR * atr
bool nearHighExtreme  = atr > 0 and high >= (priceHigh - extremeOffset)
bool nearLowExtreme   = atr > 0 and low <= (priceLow + extremeOffset)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADX PEAK EXHAUSTION (v5.2)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

bool adxPeakExhaustion = adx > 45 and adx < nz(adx[1]) and nz(adx[1]) >= nz(adx[2])

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RSI DIVERGENCE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float rsi = ta.rsi(close, 14)

float rsiPivotLow    = ta.pivotlow(rsi, divLookback, divLookback)
float rsiPivotHigh   = ta.pivothigh(rsi, divLookback, divLookback)
float pricePivotLow  = ta.pivotlow(low, divLookback, divLookback)
float pricePivotHigh = ta.pivothigh(high, divLookback, divLookback)

var float prevRsiLow    = na, var float prevPriceLow  = na
var float prevRsiHigh   = na, var float prevPriceHigh = na

bool bullishDivergence = false
bool bearishDivergence = false

if not na(rsiPivotLow) and not na(pricePivotLow)
    bullishDivergence := not na(prevRsiLow) and not na(prevPriceLow) and pricePivotLow < prevPriceLow and rsiPivotLow > prevRsiLow and rsiPivotLow < 45
    prevRsiLow := rsiPivotLow
    prevPriceLow := pricePivotLow

if not na(rsiPivotHigh) and not na(pricePivotHigh)
    bearishDivergence := not na(prevRsiHigh) and not na(prevPriceHigh) and pricePivotHigh > prevPriceHigh and rsiPivotHigh < prevRsiHigh and rsiPivotHigh > 55
    prevRsiHigh := rsiPivotHigh
    prevPriceHigh := pricePivotHigh

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HTF VALIDATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

string htf = tfMinutes <= 1 ? "5" : tfMinutes <= 5 ? "15" : tfMinutes <= 15 ? "60" : tfMinutes <= 60 ? "240" : "D"

htfChopCalc() =>
    float _trSum  = math.sum(ta.tr(true), 14)
    float _rangeN = ta.highest(high, 14) - ta.lowest(low, 14)
    _rangeN > 0 and _trSum > 0 ? 100 * math.log10(_trSum / _rangeN) / math.log10(14) : 100

[htfTrendUp, htfChop, htfRsi] = request.security(syminfo.tickerid, htf, [ta.ema(close, 50) > ta.ema(close, 200), htfChopCalc(), ta.rsi(close, 14)], lookahead=barmerge.lookahead_off)

bool htfOversold  = htfRsi < 40
bool htfOverbought = htfRsi > 60
bool htfSupportsLong  = not useMultiTimeframe or ((htfTrendUp or htfChop > 55) and (htfOversold or htfChop > 50))
bool htfSupportsShort = not useMultiTimeframe or ((not htfTrendUp or htfChop > 55) and (htfOverbought or htfChop > 50))
bool htfAlignedLong   = htfOversold and htfRsi < 35
bool htfAlignedShort  = htfOverbought and htfRsi > 65

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCORING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

float longScore = 0.0
if parabolicDown
    longScore += 2.0
if bullishReversalCandle
    longScore += 2.0
if threeOutsideUp
    longScore += 0.5
if parabolicDown and bullishReversalCandle
    longScore += 0.8
if bullishEngulfing
    longScore += 0.5
if rocExtremeBull
    longScore += 1.2
if hasVolumeSignal
    longScore += volumeWeight
if bullishVolDiv
    longScore += 1.0
if velocityDecreasing
    longScore += 1.2
if nearLowExtreme
    longScore += T_PRICE_EXTREME
if bullishDivergence
    longScore += 1.5
if htfAlignedLong
    longScore += 0.8
if bbwExtreme
    longScore += 0.8
if zExtLow
    longScore += 1.0
if adxPeakExhaustion and parabolicDown
    longScore += 0.8
if wyckoffAbsorptionBull
    longScore += 0.5

float shortScore = 0.0
if parabolicUp
    shortScore += 2.0
if bearishReversalCandle
    shortScore += 2.0
if threeOutsideDown
    shortScore += 0.5
if parabolicUp and bearishReversalCandle
    shortScore += 0.8
if bearishEngulfing
    shortScore += 0.5
if rocExtremeBear
    shortScore += 1.2
if hasVolumeSignal
    shortScore += volumeWeight
if bearishVolDiv
    shortScore += 1.0
if velocityDecreasing
    shortScore += 1.2
if nearHighExtreme
    shortScore += T_PRICE_EXTREME
if bearishDivergence
    shortScore += 1.5
if htfAlignedShort
    shortScore += 0.8
if bbwExtreme
    shortScore += 0.8
if zExtHigh
    shortScore += 1.0
if adxPeakExhaustion and parabolicUp
    shortScore += 0.8
if wyckoffAbsorptionBear
    shortScore += 0.5

// Penalties
bool downTrendStrong = isTrending and diMinus > diPlus
bool upTrendStrong   = isTrending and diPlus > diMinus
bool allowCatchKnife = exceptionalVolume and (bullishReversalCandle or bearishReversalCandle)

if downTrendStrong and parabolicDown and not allowCatchKnife
    longScore -= T_PENALTY
if upTrendStrong and parabolicUp and not allowCatchKnife
    shortScore -= T_PENALTY
if not isScalp and useChopFilterSwing and chop >= 62
    longScore -= 1.0
    shortScore -= 1.0

longScore  := math.max(longScore, 0.0)
shortScore := math.max(shortScore, 0.0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIGNAL GENERATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

int minScoreBase     = signalMode == "Conservative" ? (isScalp ? 6 : 7) : (isScalp ? 5 : 6)
int minScoreRequired = minimumScoreOverride > 0 ? minimumScoreOverride : minScoreBase
bool requireRevCandle = signalMode == "Conservative" and requireReversalCandleConservative

int minConfBase     = isScalp ? (signalMode == "Conservative" ? 3 : 2) : (signalMode == "Conservative" ? 4 : 3)
int minConfRequired = confirmationsOverride > 0 ? confirmationsOverride : minConfBase
if extraConfirmationInChop and not isTrending and not isHighVolatility
    minConfRequired += 1
minConfRequired := math.min(minConfRequired, 5)

int longConf  = (longScore >= minScoreRequired ? 1 : 0) + (bullishReversalCandle or nearLowExtreme or bullishEngulfing ? 1 : 0) + (velocityDecreasing ? 1 : 0) + (hasVolumeSignal or bullishVolDiv ? 1 : 0) + (rsi < T_RSI_LOW or bullishDivergence or zExtLow ? 1 : 0)
int shortConf = (shortScore >= minScoreRequired ? 1 : 0) + (bearishReversalCandle or nearHighExtreme or bearishEngulfing ? 1 : 0) + (velocityDecreasing ? 1 : 0) + (hasVolumeSignal or bearishVolDiv ? 1 : 0) + (rsi > T_RSI_HIGH or bearishDivergence or zExtHigh ? 1 : 0)

bool trendOkLong  = not useTrendFilter or not bearishRegime or bullishDivergence
bool trendOkShort = not useTrendFilter or not bullishRegime or bearishDivergence

bool longSetup  = parabolicDown and longScore >= minScoreRequired and longConf >= minConfRequired and trendOkLong and htfSupportsLong and volatilityFilterOk and chopOk and (not requireRevCandle or bullishReversalCandle)
bool shortSetup = parabolicUp and shortScore >= minScoreRequired and shortConf >= minConfRequired and trendOkShort and htfSupportsShort and volatilityFilterOk and chopOk and (not requireRevCandle or bearishReversalCandle)

var int lastSignalBar = na
bool cooldownOk = signalCooldown == 0 or na(lastSignalBar) or (bar_index - lastSignalBar) >= signalCooldown

bool longSignal  = longSetup and cooldownOk and longScore >= shortScore and barstate.isconfirmed
bool shortSignal = shortSetup and cooldownOk and shortScore > longScore and barstate.isconfirmed

if longSignal or shortSignal
    lastSignalBar := bar_index

int longConfidence  = longScore >= (minScoreRequired + 2) ? 3 : longScore >= (minScoreRequired + 1) ? 2 : 1
int shortConfidence = shortScore >= (minScoreRequired + 2) ? 3 : shortScore >= (minScoreRequired + 1) ? 2 : 1

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// OSCILLATOR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

var float maxLongScore  = 8.0
var float maxShortScore = 8.0
maxLongScore  := math.max(longScore, maxLongScore * 0.999)
maxShortScore := math.max(shortScore, maxShortScore * 0.999)

float effMaxLong  = math.max(maxLongScore, 6.0)
float effMaxShort = math.max(maxShortScore, 6.0)

float rawOsc = 50.0
if parabolicDown and longScore >= minScoreRequired
    rawOsc := 50.0 - math.min(1.0, longScore / effMaxLong) * 50.0
else if parabolicUp and shortScore >= minScoreRequired
    rawOsc := 50.0 + math.min(1.0, shortScore / effMaxShort) * 50.0
else if longScore > 0 and not parabolicUp
    rawOsc := 50.0 - math.min(1.0, longScore / effMaxLong) * 20.0
else if shortScore > 0 and not parabolicDown
    rawOsc := 50.0 + math.min(1.0, shortScore / effMaxShort) * 20.0
else
    float decay = isScalp ? 0.60 : 0.75
    rawOsc := na(rawOsc[1]) ? 50.0 : (math.abs(rawOsc[1] - 50.0) < 2 ? 50.0 : rawOsc[1] * decay + 50.0 * (1 - decay))

float osc = smoothingPeriod > 1 ? ta.ema(rawOsc, smoothingPeriod) : rawOsc

float volAdj    = isHighVolatility ? 1.2 : 1.0
float baseZone  = (isScalp ? 18.0 : 20.0) * volAdj
float upperZone = 50 + baseZone
float lowerZone = 50 - baseZone

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VISUALS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

p100 = plot(100, "Upper Bound", color.new(bearishColor, 85), 1)
pUpper = plot(showThresholdZones ? upperZone : na, "Overbought", color.new(bearishColor, 70), 1)
plot(50, "Centerline", color.new(color.gray, 80), 1, plot.style_cross)
pLower = plot(showThresholdZones ? lowerZone : na, "Oversold", color.new(bullishColor, 70), 1)
p0 = plot(0, "Lower Bound", color.new(bullishColor, 85), 1)

fill(p100, pUpper, showThresholdZones ? color.new(bearishColor, 92) : na, "Overbought Zone")
fill(p0, pLower, showThresholdZones ? color.new(bullishColor, 92) : na, "Oversold Zone")

color lineColor = osc >= upperZone ? bearishColor : osc <= lowerZone ? bullishColor : osc > 50 ? color.new(bearishColor, 20) : osc < 50 ? color.new(bullishColor, 20) : color.new(color.gray, 10)
plot(osc, "PE-RP", lineColor, 3)

// Signal Markers
plotshape(showSignalMarkers and longSignal and longConfidence == 3 ? osc - 6 : na, "Premium Long", shape.labelup, location.absolute, bullishColor, text="P", textcolor=color.white, size=size.small)
plotshape(showSignalMarkers and longSignal and longConfidence == 2 ? osc - 5 : na, "High Long", shape.labelup, location.absolute, bullishColor, text="H", textcolor=color.white, size=size.tiny)
plotshape(showSignalMarkers and longSignal and longConfidence == 1 ? osc - 4 : na, "Std Long", shape.triangleup, location.absolute, color.new(bullishColor, 20), size=size.tiny)
plotshape(showSignalMarkers and shortSignal and shortConfidence == 3 ? osc + 6 : na, "Premium Short", shape.labeldown, location.absolute, bearishColor, text="P", textcolor=color.white, size=size.small)
plotshape(showSignalMarkers and shortSignal and shortConfidence == 2 ? osc + 5 : na, "High Short", shape.labeldown, location.absolute, bearishColor, text="H", textcolor=color.white, size=size.tiny)
plotshape(showSignalMarkers and shortSignal and shortConfidence == 1 ? osc + 4 : na, "Std Short", shape.triangledown, location.absolute, color.new(bearishColor, 20), size=size.tiny)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ALERTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

alertcondition(alertPremiumSignals and longSignal and longConfidence == 3, "Premium Long", "PREMIUM LONG\nPE-RP v5.2")
alertcondition(alertPremiumSignals and shortSignal and shortConfidence == 3, "Premium Short", "PREMIUM SHORT\nPE-RP v5.2")
alertcondition(alertHighSignals and longSignal and longConfidence == 2, "HIGH Long", "HIGH QUALITY LONG\nPE-RP v5.2")
alertcondition(alertHighSignals and shortSignal and shortConfidence == 2, "HIGH Short", "HIGH QUALITY SHORT\nPE-RP v5.2")
alertcondition(alertStandardSignals and longSignal and longConfidence <= 1, "Standard Long", "STANDARD LONG\nPE-RP v5.2")
alertcondition(alertStandardSignals and shortSignal and shortConfidence <= 1, "Standard Short", "STANDARD SHORT\nPE-RP v5.2")

bool enteringOverbought = ta.crossover(osc, upperZone)
bool enteringOversold   = ta.crossunder(osc, lowerZone)

alertcondition(alertZoneWarnings and enteringOversold, "Oversold Zone", "OVERSOLD\nPE-RP v5.2")
alertcondition(alertZoneWarnings and enteringOverbought, "Overbought Zone", "OVERBOUGHT\nPE-RP v5.2")
alertcondition(alertZoneWarnings and osc <= 15, "EXTREME Oversold", "EXTREME OVERSOLD\nPE-RP v5.2")
alertcondition(alertZoneWarnings and osc >= 85, "EXTREME Overbought", "EXTREME OVERBOUGHT\nPE-RP v5.2")
alertcondition(showDivergences and bullishDivergence, "Bullish Divergence", "BULLISH DIVERGENCE\nPE-RP v5.2")
alertcondition(showDivergences and bearishDivergence, "Bearish Divergence", "BEARISH DIVERGENCE\nPE-RP v5.2")
alertcondition(bullishVolDiv and nearLowExtreme, "Bullish Vol Div", "BULLISH VOL DIVERGENCE\nPE-RP v5.2")
alertcondition(bearishVolDiv and nearHighExtreme, "Bearish Vol Div", "BEARISH VOL DIVERGENCE\nPE-RP v5.2")
